var width=840,height=width,radius=width/2,x=d3.scale.linear().range([0,2*Math.PI]),y=d3.scale.pow().exponent(1.3).domain([0,1]).range([0,radius]),padding=5,duration=1e3,div=d3.select("#vis");div.select("img").remove();var vis=div.append("svg").attr("width",width+2*padding).attr("height",height+2*padding).append("g").attr("transform","translate("+[radius+padding,radius+padding]+")"),partition=d3.layout.partition().sort(null).value(function(t){return 5.8-t.depth}),arc=d3.svg.arc().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,x(t.x)))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,x(t.x+t.dx)))}).innerRadius(function(t){return Math.max(0,t.y?y(t.y):t.y)}).outerRadius(function(t){return Math.max(0,y(t.y+t.dy))});function isParentOf(t,n){return t===n||!!t.children&&t.children.some(function(t){return isParentOf(t,n)})}function color(t){if(t.children){var n=t.children.map(color),r=d3.hsl(n[0]),e=d3.hsl(n[1]);return d3.hsl((r.h+e.h)/2,1.2*r.s,r.l/1.2)}return t.color||"#fff"}function arcTween(t){var n=maxY(t),r=d3.interpolate(x.domain(),[t.x,t.x+t.dx]),e=d3.interpolate(y.domain(),[t.y,n]),a=d3.interpolate(y.range(),[t.y?20:0,radius]);return function(t){return function(n){return x.domain(r(n)),y.domain(e(n)).range(a(n)),arc(t)}}}function maxY(t){return t.children?Math.max.apply(Math,t.children.map(maxY)):t.y+t.dy}function brightness(t){return .299*t.r+.587*t.g+.114*t.b}d3.json("./assets/data/curriculum.json",function(t,n){var r=partition.nodes({children:n}),e=vis.selectAll("path").data(r);e.enter().append("path").attr("id",function(t,n){return"path-"+n}).attr("d",arc).attr("fill-rule","evenodd").style("fill",color).on("click",d);var a=vis.selectAll("text").data(r),i=a.enter().append("text").style("fill-opacity",1).style("fill",function(t){return 125>brightness(d3.rgb(color(t)))?"#eee":"#000"}).attr("text-anchor",function(t){return x(t.x+t.dx/2)>Math.PI?"end":"start"}).attr("dy",".2em").attr("transform",function(t){var n=(t.name||"").split(" ").length>1,r=180*x(t.x+t.dx/2)/Math.PI-90;return"rotate("+(r+(n?-.5:0))+")translate("+(y(t.y)+padding)+")rotate("+(r>90?-180:0)+")"}).on("click",d);function d(t){e.transition().duration(duration).attrTween("d",arcTween(t)),a.style("visibility",function(n){return isParentOf(t,n)?null:d3.select(this).style("visibility")}).transition().duration(duration).attrTween("text-anchor",function(t){return function(){return x(t.x+t.dx/2)>Math.PI?"end":"start"}}).attrTween("transform",function(t){var n=(t.name||"").split(" ").length>1;return function(){var r=180*x(t.x+t.dx/2)/Math.PI-90;return"rotate("+(r+(n?-.5:0))+")translate("+(y(t.y)+padding)+")rotate("+(r>90?-180:0)+")"}}).style("fill-opacity",function(n){return isParentOf(t,n)?1:1e-6}).each("end",function(n){d3.select(this).style("visibility",isParentOf(t,n)?null:"hidden")})}i.append("tspan").attr("x",0).text(function(t){return t.depth?t.name.split(" ")[0]:""}),i.append("tspan").attr("x",0).attr("dy","1em").text(function(t){return t.depth&&t.name.split(" ")[1]||""})});