var width=960,height=650,radius=Math.min(width,height)/2,colors={"Create workstation":"#E14E5F","Create models":"#A87621","Create data":"#43943E","Publish & consume data":"#AC5CC4","Extract data":"#2E99A0","Query data":"#2986EC","Visualize data":"#E14E5F","Analyze data":"#A87621","Implement applications":"#43943E","Seek advice":"#AC5CC4"},colorOpacity=.7,svg=d3.select("#chart").append("svg").attr("width",width).attr("height",height).append("g").attr("transform","translate("+width/2.5+","+height/2+") scale(.95)").call(d3.behavior.zoom().scaleExtent([1,12]).on("zoom",zoom)).append("g");function zoom(){svg.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}var partition=d3.layout.partition().size([2*Math.PI,radius*radius]).value(function(t){return t.size}),arc=d3.svg.arc().startAngle(function(t){return t.x}).endAngle(function(t){return t.x+t.dx}).innerRadius(function(t){return Math.sqrt(t.y)}).outerRadius(function(t){return Math.sqrt(t.y+t.dy)}),text=svg.append("text").attr("x",0).attr("y",0).attr("dy","0.35em");function drawLegend(){var t={w:155,h:30,s:3,r:3},e=svg.append("g").attr("transform",function(e,r){return"translate("+(width/1.8-1.3*t.w)+","+(height/2-t.h*Object.keys(colors).length*1.2)+")"}).selectAll("g").data(d3.entries(colors)).enter().append("svg:g").attr("transform",function(e,r){return"translate(0,"+r*(t.h+t.s)+")"});e.append("svg:rect").attr("rx",t.r).attr("ry",t.r).attr("width",t.w).attr("height",t.h).style("opacity",colorOpacity).style("fill",function(t){return t.value}),e.append("svg:text").attr("x",t.w/2).attr("y",t.h/2).attr("dy","0.35em").attr("text-anchor","middle").classed("legendItem",!0).text(function(t){return t.key})}getColor=function(t){var e;if("Curriculum"===t.name)return"#7E7F7E";if(t.name in colors)return colors[t.name];for(e="#7E7F7E";"Curriculum"!==t.parent.name;){if(t.parent.name in colors){e=colors[t.parent.name];break}t=t.parent}return e},thousand_sep_format=d3.format(","),drawLegend(),d3.json("./assets/data/curriculum.json",function(t,e){(function t(e){if(!e.hasOwnProperty("children"))return e.size=1,1;var r=0;return e.children.forEach(function(e){r+=t(e)}),e.size=r,e.size})(e),e={name:e.name,size:e.size,children:[e]},svg.datum(e).selectAll("path").data(partition.nodes).enter().append("path").attr("display",function(t){return t.depth?null:"none"}).attr("d",arc).style("stroke","#fff").style("fill",function(t){return getColor(t)}).style("opacity",colorOpacity).on("mouseover",function t(r){var n=(100*r.size/e.size).toPrecision(3);text.html("<tspan style='font-size: 30px' x='0' dy='-20'>"+thousand_sep_format(r.size)+"</tspan><tspan style='font-size: 15px' x='0' dy='25'>"+r.name+"</tspan><tspan style='font-size: 30px' x='0' dy='35'>"+n+"%</tspan>"),d3.selectAll("path").filter(function(t){return r===t}).style("opacity",.5)}).on("mouseout",function t(e){text.html(""),d3.selectAll("path").filter(function(t){return e===t}).style("opacity",colorOpacity)})}),d3.select(self.frameElement).style("height",height+"px");