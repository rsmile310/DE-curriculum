var root,w=960,h=800,i=0,barHeight=20,barWidth=.4*w,duration=400,tree=d3.layout.tree().size([h,100]),diagonal=d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),vis=d3.select("#chart").append("svg:svg").attr("width",w).attr("height",h).append("svg:g").attr("transform","translate(20,30)");function moveChildren(t){t.children&&(t.children.forEach(function(t){moveChildren(t)}),t._children=t.children,t.children=null)}function update(t){var r=tree.nodes(root);r.forEach(function(t,r){t.x=r*barHeight});var n=vis.selectAll("g.node").data(r,function(t){return t.id||(t.id=++i)}),a=n.enter().append("svg:g").attr("class","node").attr("transform",function(r){return"translate("+t.y0+","+t.x0+")"}).style("opacity",1e-6);a.append("svg:rect").attr("y",-barHeight/2).attr("height",barHeight).attr("width",barWidth).style("fill",color).on("click",click),a.append("svg:text").attr("dy",3.5).attr("dx",5.5).text(function(t){return t.name}),a.transition().duration(duration).attr("transform",function(t){return"translate("+t.y+","+t.x+")"}).style("opacity",1),n.transition().duration(duration).attr("transform",function(t){return"translate("+t.y+","+t.x+")"}).style("opacity",1).select("rect").style("fill",color),n.exit().transition().duration(duration).attr("transform",function(r){return"translate("+t.y+","+t.x+")"}).style("opacity",1e-6).remove();var e=vis.selectAll("path.link").data(tree.links(r),function(t){return t.target.id});e.enter().insert("svg:path","g").attr("class","link").attr("d",function(r){var n={x:t.x0,y:t.y0};return diagonal({source:n,target:n})}).transition().duration(duration).attr("d",diagonal),e.transition().duration(duration).attr("d",diagonal),e.exit().transition().duration(duration).attr("d",function(r){var n={x:t.x,y:t.y};return diagonal({source:n,target:n})}).remove(),r.forEach(function(t){t.x0=t.x,t.y0=t.y})}function click(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null),update(t)}function color(t){return t._children?"#3182bd":t.children?"#c6dbef":"#fd8d3c"}d3.json("./assets/data/curriculum.json",function(t){t.x0=0,t.y0=0,moveChildren(t),update(root=t)});