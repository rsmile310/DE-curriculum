var width=960,height=770,radius=Math.min(width,height)/2,x=d3.scale.linear().range([0,2*Math.PI]),y=d3.scale.linear().range([0,radius]),color=d3.scale.category20c(),svg=d3.select("#chart").append("svg").attr("width",width).attr("height",height).append("g").attr("transform","translate("+width/2.5+","+(height/2+15)+") scale(.98)"),partition=d3.layout.partition().value(function(t){return t.size}),arc=d3.svg.arc().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,x(t.x)))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,x(t.x+t.dx)))}).innerRadius(function(t){return Math.max(0,y(t.y))}).outerRadius(function(t){return Math.max(0,y(t.y+t.dy))});function arcTween(t){var n=d3.interpolate(x.domain(),[t.x,t.x+t.dx]),e=d3.interpolate(y.domain(),[t.y,1]),r=d3.interpolate(y.range(),[t.y?20:0,radius]);return function(t,a){return a?function(n){return arc(t)}:function(a){return x.domain(n(a)),y.domain(e(a)).range(r(a)),arc(t)}}}function computeTextRotation(t){return(x(t.x+t.dx/2)-Math.PI/2)/Math.PI*180}d3.json("./assets/data/curriculum.json",function(t,n){var e=svg.selectAll("g").data(partition.nodes(n)).enter().append("g"),r=e.append("path").attr("d",arc).style("fill",function(t){return color((t.children?t:t.parent).name)}).on("click",function t(n){a.transition().attr("opacity",0),r.transition().duration(750).attrTween("d",arcTween(n)).each("end",function(t,e){t.x>=n.x&&t.x<n.x+n.dx&&d3.select(this.parentNode).select("text").transition().duration(750).attr("opacity",1).attr("transform",function(){return"rotate("+computeTextRotation(t)+")"}).attr("x",function(t){return y(t.y)})})}),a=e.append("text").attr("transform",function(t){return"rotate("+computeTextRotation(t)+")"}).attr("x",function(t){return y(t.y)}).attr("dx","6").attr("dy",".35em").text(function(t){return t.name})}),d3.select(self.frameElement).style("height",height+"px");